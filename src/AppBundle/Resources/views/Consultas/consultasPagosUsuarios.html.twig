{% extends 'base.html.twig' %}

{% block body %}
<div class="container-responsive" id="logoEmpresa">
  <img src="{{ conf['urllogoempresa'] }}" class="img-fluid" height="100" width="650" alt="Logo Empresa">
  <div class="help-block text-center">Sistema de Recaudos Web Redylab v. 1.0</div>
</div>
<hr class="m-0">
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-12 text-center">
            <header class='text-center'>
                <h2>Consultar Pagos de Usuarios.</h2>
                <span class="help-block"><li class="fa fa-info-circle text-info"></li> Este es un módulo de consultas que le permitirá al usuario verificar el pago de su servicio. Para usar este módulo digite el número de la factura, el número de su matricula o el código de la transacción de su recibo de pago y luego presione el botón Consultar. Señor Usuario recuerde que para imprimir nuevamente su recibo de pago debe tener habilitado las ventanas emergentes en su navegador.</span>
            </header>
            <main class="text-center">
              {{ form_start(form) }}
                <div class="row text-center">
                  <div class="row col-md-12">
                    <div class="col-md-4">
                      <div class="text-left">{{ form_label(form.nroFactura) }}</div>
                      <div class="text-right label">{{ form_widget(form.nroFactura) }}</div>
                    </div>
                    <div class="col-md-4">
                      <div class="text-left">{{ form_label(form.matricula) }}<span class="help-block">Se obtiene los últimos 10 pagos</span></div>
                      <div class="text-left">{{ form_widget(form.matricula) }}</div>
                    </div>
                    <div class="col-md-4">
                      <div class="text-left">{{ form_label(form.codigoTransaccion) }}</div>
                      <div class="text-right label">{{ form_widget(form.codigoTransaccion) }}</div>
                    </div>
                  </div>
                </div>
                <br>
                <div class="text-center">
                  <input type="submit" class='btn btn-primary' value="Consultar" />
                </div>
              {{ form_end(form) }}
            </main>
        </div>
        <br>
        {% if mensajes is defined and mensajes is not null %}
            <div id='mensaje' class="alert alert-warning alert-dismissible mt-3" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              {{ mensajes }}
            </div>
        {% endif %}
        {% if transacciones is defined %}
          <div class="container-fluid mt-3" style="height: 400px;">
            <div class="table-responsive">
              <table class="table table-sm table-striped">
                <thead>
                  <tr>
                    <th>Item</th>
                    <th>Código Transacción</th>
                    <th>Fecha Pago</th>
                    <th>Nro. Factura</th>
                    <th>Usuario</th>
                    <th>Valor Pago</th>
                    <th>Sede Agencia</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item, trans in transacciones %}
                    <tr>
                        <td>{{ item+1 }}</td>
                        <td>{{ trans.getIdTransaccion().getNroTransaccion() }}</td>
                        <td>{{ trans.getFechaHoraPago()|date("d/m/Y h:i:s a") }}</td>
                        <td>{{ trans.getIdFactura().getNroFactura() }}</td>
                        <td>{{ trans.getIdFactura().getNombreUsuario()|title }}</td>
                        <td>{{ trans.getVlrPago()|number_format(0,".",",") }}</td>
                        <td>{{ trans.getIdTransaccion().getIdEmpresaSedeAgencia.getIdSedeAgencia() }}</td>
                        <td><a id="getRecibo" target="_blank" href="{{ path('getRecibo',{idTransaccion:trans.getIdTransaccion().getIdTransaccion() }) }}"><li class="fa fa-print cTomato"> Imprimir Recibo</li></a></td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block javascripts %}
  $(document).ready(function(){
   /*$("#getRecibo").click(function(e){
      e.preventDefault();

      var urlServiceRecibo = $("#getRecibo").attr("href");

      $.get(urlServiceRecibo,function(response){
        var ventimp = window.open("",'',"width=380,height=660,toolbar=no,scrollbars=no");
        ventimp.document.write(response);
        ventimp.document.close();
      })
    });*/
  });
{% endblock %}
